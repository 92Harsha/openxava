<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>openxava - tomcat_es</title>
    <link rel="stylesheet" href="static/style.css" type="text/css">
    <link rel="stylesheet" href="highlight/highlight.css">
    <script src="highlight/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div class="wiki" style="display: block;">
      <h1 id="toc0">Desplegar en producción con Tomcat</h1>
      Puedes desplegar tus aplicaciones OpenXava en cualquier servidor de
      aplicaciones Java con soporte de Servlet 3.0 o superior. Para esta guía
      vamos a usar Apache Tomcat para desplegar tu aplicación OpenXava. Tomcat
      es el servidor de aplicaciones Java más usado y robusto, ideal para
      entornos de producción.<br>
      <h2 id="toc1">Descargar e instalar Tomcat</h2>
      <a href="https://tomcat.apache.org/download-90.cgi">Descarga Tomcat 9</a>
      desde Apache. OpenXava también funciona bien con Tomcat 8 y 7. Descomprime
      el Tomcat en una carpeta de tu elección. Ve a la carpeta <i>webapps</i> y
      borra las carpetas que hay dentro: <i>docs, examples, host-manager,
        manager</i> and <i>ROOT</i>. Son aplicaciones de ejemplo y
      administración que no deberías tener en un sistema de producción.</div>
    <div class="wiki" style="display: block;">
      <h2 id="toc1">El controlador JDBC<br>
      </h2>
      Has de copiar el jar del controlador JDBC en la carpeta <i>lib</i> de tu
      Tomcat. Si todavía estás usando la base de datos HSQLDB incluida con
      OpenXava, este jar sería <i>hsqldb.jar</i> de <i>OpenXava/lib</i>. Pero
      si estás usando MySQL, Oracle, PostgreSQL, etc. deberías obtener el
      controlador JDBC adecuado para tu base de datos y copiarlo en la carpeta <i>lib</i>
      del Tomcat.<br>
      <strong></strong></div>
    <div class="wiki" style="display: block;">
      <h2 id="toc1">Crear y desplegar el WAR<br>
      </h2>
      Para desplegar tu aplicación en Tomcat has de crear un archivo WAR desde
      tu proyecto. Para ello, pulsa con el botón derecho del ratón en el archivo
      <i>build.xml</i> de tu proyecto y escoge <i>Run As &gt; Ant Build...</i>:</div>
    <img src="files/run-as-ant-build_es.png" alt="">
    <div class="wiki" style="display: block;">Entonces quita la selección que
      haya y selecciona la tarea Ant <i>createWar</i>:</div>
    <img src="files/run-deploy-war-ant-target_es.png"

      alt="">
    <div class="wiki" style="display: block;">Additionally, you can put a better
      name like <i>Invoicing.createWar</i> in this case. Click on <i>Run</i>.
      Wait until the the Ant target execution finishes, afterwards get the file
      <i>Invoicing.war</i> (or <i>YourApplicationName.war</i>) and copy it to
      the <i>webapps</i> folder of your Tomcat. Your application is already
      deployed.</div>
    <div class="wiki" style="display: block;">
      <h2>Run Tomcat</h2>
      <h2><span style="color: rgb(80, 80, 80); font-family: arial, helvetica, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">To
          start your Tomcat, with Windows click<span>&nbsp;</span></span><em style="color: rgb(80, 80, 80); font-family: arial, helvetica, sans-serif; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;">Start</em><span

          style="color: rgb(80, 80, 80); font-family: arial, helvetica, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"><span>&nbsp;</span>type<span>&nbsp;</span></span><em

          style="color: rgb(80, 80, 80); font-family: arial, helvetica, sans-serif; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;">cmd</em><span

          style="color: rgb(80, 80, 80); font-family: arial, helvetica, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"><span>&nbsp;</span>and
          press ENTER, then:</span><span style="color: rgb(80, 80, 80); font-family: arial, helvetica, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">:</span></h2>
    </div>
    <div class="wiki" style="display: block;">
      <pre><code class="shell">cd tomcat-9.0.24\bin
set JAVA_HOME=C:\Program Files\Java\jdk-11.0.3
startup</code></pre>
    </div>
    <div class="wiki" style="display: block;">With Linux/Mac:
      <div class="wiki" style="display: block;">
        <pre><code class="shell">$ cd tomcat-9.0.24/bin
$ export JAVA_HOME=/usr/lib/jvm/java-11-openjdk
$ ./startup.sh</code></pre>
      </div>
      <div class="wiki" style="display: block;">Of course, adjust the URLs for
        your own Tomcat and Java directories.</div>
      <div class="wiki" style="display: block;">Congratulations! Your
        application is already running in production, just use your browser to
        access to it.</div>
    </div>
    <div class="wiki" style="display: block;">
      <h2 id="toc1">Configure against production database</h2>
      By default your application goes against the same database you're using in
      development, the one defined in the datasource from <i>web/META-INF/context.xml</i>
      of your project. Most times you want to use a different database for
      production, to overwrite the database used by your application you have to
      define the datasource in the <i>context.xml</i> found in the <i>conf</i>
      folder of your Tomcat. For our example, we should edit <i>tomcat-9.0.24/conf/context.xml</i>
      and leave it in this way:</div>
    <div class="wiki" style="display: block;">
      <pre><code class="xmls">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!-- The contents of this file will be loaded for each web application --&gt;
&lt;Context&gt;

    &lt;!-- Default set of monitored resources. If one of these changes, the    --&gt;
    &lt;!-- web application will be reloaded.                                   --&gt;
    &lt;WatchedResource&gt;WEB-INF/web.xml&lt;/WatchedResource&gt;
    &lt;WatchedResource&gt;WEB-INF/tomcat-web.xml&lt;/WatchedResource&gt;
    &lt;WatchedResource&gt;${catalina.base}/conf/web.xml&lt;/WatchedResource&gt;

    &lt;!-- Uncomment this to disable session persistence across Tomcat restarts --&gt;
    &lt;!--
    &lt;Manager pathname="" /&gt;
    --&gt;
	
	 &lt;Resource name="jdbc/InvoicingDS" auth="Container" type="javax.sql.DataSource"
	      maxTotal="20" maxIdle="5" maxWaitMillis="10000"
	      username="sa" password="" driverClassName="org.hsqldb.jdbcDriver"
	      url="jdbc:hsqldb:hsql://localhost:1999"/&gt;
	
&lt;/Context&gt;
</code></pre> </div>
    <div class="wiki" style="display: block;">We use <i>InvoicingDS</i> as
      datasource name, the same of the <i>context.xml</i> included in your WAR,
      but we define a different URL.</div>
    <div class="wiki" style="display: block;">
      <div class="wiki" style="display: block;">
        <h2 id="toc1"><br>
        </h2>
      </div>
    </div>
    <div class="wiki" style="display: block;"><br>
    </div>
  </body>
</html>
